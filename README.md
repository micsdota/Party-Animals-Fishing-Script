# 猛兽派对 - 自动钓鱼脚本 (Better Fisher-改进版)

这是一个用于"猛兽派对"秋季小屋钓鱼玩法的自动化挂机脚本，基于 [liufeng-ya/Party-Animals-Fishing-Script](https://github.com/liufeng-ya/Party-Animals-Fishing-Script) 的原版脚本进行了大量功能增强和体验优化。

---

## `better_fisher` 版本主要改进

*不同于原版专注于低分辨率窗口，better_fisher专为2560\*1440窗口设计，亦完美适配3840\*2160窗口，在1920\*1080、2560\*1080窗口中也可使用*

这个版本在原脚本的基础上，增加了以下核心功能和优化：

1.  **逻辑修改**:
    *   **更智能的收杆逻辑**: 增加了多重判断来确认钓鱼是否完成（张力表盘消失），包括在"松手调张力"之前和之后都进行检测，有效避免了因单次检测失败而陷入无限循环的问题。
    *   **对咬钩后处理的微调**：在咬钩后增加一个短暂的等待，能够在一定程度上减小空军几率。
    *   **窗口动态检测**: 脚本现在可以检测游戏窗口位置或大小的变化，并在检测到变化时动态更新像素坐标，确保在部分时机移动窗口后仍能正常工作。
    *   **咬钩检测优化**: 引入OpenCV模板匹配和HSV颜色检测的混合识别机制。先通过黄色像素快速定位疑似叹号区域，再用OpenCV精确验证exclamation_mark.png模板，提高检测准确性和速度。

2.  **增强的用户交互与控制**:
    *   **暂停/恢复功能**: 在脚本运行时，可以随时按下 `Ctrl+L` 来暂停所有动作。再次按下 `Ctrl+L` 后，脚本将从抛竿步骤重新开始新一轮钓鱼，方便您随时中断和重启。
    *   **统计功能控制**: 按下 `Ctrl+K` 可以创建或切换统计功能状态。如果统计文件不存在，会自动创建；如果已存在，则会切换启用/禁用状态。
    *   **紧急终止**: 保留了原有的 `q` 键紧急终止脚本的功能。

3.  **优化的控制台输出**:
    *   **更多的输出内容**：方便调试和装逼，但我极不推荐你把它发到网上。
    *   **清晰的输出格式**：输出内容被按颜色分类。
    *   **清晰的流程分隔**: 每轮钓鱼的开始和结束都有明显的分隔符，便于追踪。
    *   **稀有度彩色显示**: 钓鱼结果和统计使用对应稀有度的颜色标签（传奇黄色、史诗品红等），空军率以白色显示。

4.  **更真实的模拟操作**:
    *   **随机化延时**: 脚本中的大部分延时都从固定值改为了一个小的随机范围，以更好地模拟人类操作。

5.  **空军判定与处理**:
    *   **空军检测**: 通过对稀有度标签位置等像素采样判断是否空军。
    *   **空军处理**: 如果判定为空军，则跳过收鱼步骤，直接结束本轮并开始下一轮抛竿，避免无效操作，提高效率。

6.  **稀有度检测与统计**:
    *   **稀有度识别**: 检查是否空军的同时检测五种鱼稀有度（传奇、史诗、稀有、非凡、标准），基于游戏 UI 颜色基准。
    *   **实时统计**: 每轮结束时打印本次结果和累计统计，包括每种鱼数量、空军次数及空军率。
    *   **本地数据库**: 脚本会自动将钓鱼记录保存到本地的 `statistics-content.json` 文件中，包括时间戳、稀有度和是否空军等信息。
    *   **统计功能控制**: 可以通过 `Ctrl+K` 随时启用或禁用统计功能，无需重启脚本。
    *   **未知稀有度处理**: 如果稀有度检测失败但检测到鱼指示颜色（浅棕色/明黄色），则标记为"未知"并进入收鱼流程。

---

## 基础使用说明

### 准备工作

0.  **Windows 系统** + **Python 3.8 及以上版本**
1.  **鱼饵**: 确保背包里有充足的鱼饵。
2.  **钓竿**: 手持任意钓竿。
3.  **钓鱼位置**: 站在水边任何可抛竿到水里的位置即可（确保窗口的下半部分是黄色以外的颜色可以减少误判）
    *   推荐站在 **巨石缝隙**，以减少角色不必要的移动，也减少背景内容的变化。
    *   如果你准备讹沃特一笔钱，也就是鱼桶快满时，可以站在**码头**。确保不要有人来烦你，也不要有人在你前面跳舞。
4.  **窗口要求**:
    *   游戏窗口标题必须为 `"猛兽派对"`。
    *   运行脚本后，尽量避免移动游戏窗口或改变其分辨率（脚本支持部分动态调整，但为确保稳定性，请保持窗口固定）。

### 依赖库

脚本依赖以下 Python 库：

| 库             | 作用                                 |
| -------------- | ------------------------------------ |
| `pyautogui`    | 获取屏幕像素颜色、截图功能           |
| `pygetwindow`  | 获取窗口位置和大小                   |
| `keyboard`     | 监听键盘事件 (Ctrl+L, q)             |
| `pywin32`      | 获取窗口客户区大小，设置控制台颜色   |
| `ctypes`       | 注入底层鼠标事件（内置库）           |
| `opencv-python`| OpenCV图像处理和模板匹配             |
| `numpy`        | 数值计算和数组操作                   |

### 安装依赖

**方法一：一键安装（推荐）**

复制以下命令到命令行 (CMD) 或 PowerShell 中执行，将自动安装所有必需的依赖库：

```bash
pip install pyautogui keyboard pygetwindow pywin32 opencv-python numpy
```

**方法二：使用requirements.txt文件**

在命令行中执行：
```bash
pip install -r requirements.txt
```


### 使用方法

1.  **直接运行**:
    *   双击 `better_fisher.py` 文件。
    *   在倒计时结束前，迅速切换回"猛兽派对"游戏窗口。

2.  **管理员身份运行 (如果脚本无反应)**:
    *   如果直接运行无效，请尝试以管理员身份运行。
    *   **方法一**: 右键点击 `better_fisher.py`，选择"以管理员身份运行"。
    *   **方法二 (通过命令行)**:
        1.  在 Windows 搜索框中输入 `cmd`，右键点击"命令提示符"，选择"以管理员身份运行"。
        2.  在弹出的黑色窗口中，输入 `cd <你存放脚本的文件夹路径>`，然后按回车。 (例如: `cd C:\Users\YourName\Downloads`)
        3.  接着输入 `python better_fisher.py`，然后按回车。

### 统计功能说明

脚本支持本地统计功能，可以记录您的钓鱼历史数据：

#### 统计文件
- 统计数据保存在脚本同目录下的 `statistics-content.json` 文件中
- 文件采用JSON格式，包含每次钓鱼的时间戳、稀有度和是否空军等信息
- 如果统计文件不存在，脚本会自动创建并初始化

#### 统计功能控制
- **启用/禁用统计**: 按下 `Ctrl+K` 可以切换统计功能的启用/禁用状态
- **创建统计文件**: 如果统计文件不存在，按 `Ctrl+K` 会自动创建新的统计文件
- **状态提示**: 脚本会在控制台显示当前统计功能的状态和操作提示

#### 统计显示
- 每轮钓鱼结束后会显示本次运行的历史统计数据
- 按稀有度分类显示钓鱼数量和百分比
- 显示空军次数和空军率
- 未知稀有度和空军数据以灰色显示，便于区分

#### 归档
- 按下`Ctrl+K+Enter`即可将统计文件归档，程序会创建一个“archived-data”文件夹并存入带时间戳的统计文件，然后创建一个新的空文件
- 每次显示历史数据时会显示本次记录的数据和历史数据总和

### 免责声明

1. **版权声明**：
   - 本版本基于 [liufeng-ya/Party-Animals-Fishing-Script](https://github.com/liufeng-ya/Party-Animals-Fishing-Script) 的主分支脚本进行修改
   - 原始脚本的一切权利归原作者 liufeng-ya 所有
   - 本改进版仅用于学习和交流目的

2. **使用风险**：
   - 用户明确知悉：该脚本属于游戏辅助工具，可能被游戏开发商视为作弊行为
   - 使用此类工具可能违反游戏服务条款和社区规范
   - 使用本脚本可能导致游戏账号受到警告、临时封禁或永久封禁等处罚
   - 脚本可能因游戏更新而失效，或导致游戏异常、数据丢失等问题

3. **责任限制**：
   - 用户使用本脚本所造成的一切后果和损失，包括但不限于账号封禁、数据丢失、设备损坏等，均由用户自行承担
   - 脚本作者 Samm-Fang 和原作者 liufeng-ya 对用户使用本脚本所产生的任何直接或间接损失不承担任何责任
   - 用户因使用本脚本而导致的任何法律纠纷，均与脚本作者无关

4. **使用同意**：
   - 下载、安装或使用本脚本即表示您已充分理解并同意上述免责声明的全部内容